<!DOCTYPE html>
<html lang="es" xmlns="https://www.thymeleaf.org"
    th:replace="~{fragments/layout :: layout(~{::title}, 'inicio' ,~{::main}, ~{::script})}">
<header>
    <title>Platos</title>
</header>

<body>

    <main th:fragment="platos" class="container main-content">
        <div class=" header">
            <h2>Añadir Nuevo Plato</h2>
            <p>Completa el formulario para añadir un nuevo plato a la carta</p>
            <div th:if="${mensaje}" class="alert alert-success" role="alert" th:text="${mensaje}"></div>
        </div>

        <div class="row mt-4">
            <!-- Formulario para añadir plato -->
            <div class="col-md-6">
                <div class="card form-card">
                    <div class="card-body">
                        <form th:action="@{/platos/subirplatos}" method="post" enctype="multipart/form-data">
                            <input type="hidden" th:if="${plato.id != null}" name="id" th:value="${plato.id}">

                            <div class="mb-3">
                                <label for="nombre" class="form-label">Nombre del Plato</label>
                                <input type="text" class="form-control" id="nombre" name="nombre"
                                    placeholder="Ej: Hamburguesa Especial" required th:value="${plato.nombre}">
                            </div>
                            <div class="mb-3">
                                <label for="precio" class="form-label">Precio (S/)</label>
                                <div class="input-group">
                                    <span class="input-group-text">S/</span>
                                    <input type="number" class="form-control" id="precio" name="precio"
                                        placeholder="0.00" step="0.01" min="0" required th:value="${plato.precio}">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="descripcion" class="form-label">Descripción Breve</label>
                                <textarea class="form-control" id="descripcion" name="descripcion" rows="3"
                                    placeholder="Describe brevemente el plato..." required
                                    th:text="${plato.descripcion}"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="categoria" class="form-label">Categoría</label>
                                <select class="form-select" id="categoria" name="categoria">
                                    <option selected>Seleccionar categoría</option>
                                    <option value="Entradas" th:selected="${plato.categoria == 'Entradas'}">
                                        Entradas</option>
                                    <option value="Platos Principales"
                                        th:selected="${plato.categoria == 'Platos Principales'}">Platos
                                        Principales</option>
                                    <option value="Postres" th:selected="${plato.categoria == 'Postres'}">
                                        Postres</option>
                                    <option value="Bebidas" th:selected="${plato.categoria == 'Bebidas'}">
                                        Bebidas</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="imagen" class="form-label">Imagen del Plato</label>
                                <input class="form-control" type="file" id="imagen" name="imagen" accept="image/*">
                                <div class="form-text">Sube una imagen para mostrar en la carta (opcional)</div>
                                <div th:if="${plato.imagenUrl != null}" class="mt-2">
                                    <img th:src="${plato.imagenUrl}" alt="Imagen actual" style="max-width: 100px;">
                                    <p class="small">Imagen actual</p>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="disponible" class="form-label">Disponibilidad</label>
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="disponible" name="disponible"
                                        th:checked="${plato.disponible}">
                                    <label class="form-check-label" for="disponible">Disponible para
                                        ordenar</label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">
                                <span th:if="${plato.id == null}">Añadir Plato</span>
                                <span th:if="${plato.id != null}">Actualizar Plato</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Vista previa del plato -->
            <div class="col-md-6">
                <div class="card preview-card">
                    <div class="card-header">
                        <h5>Vista Previa en la Carta</h5>
                    </div>
                    <div class="card-body">
                        <div class="preview-container">
                            <div class="preview-item">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="preview-image-container me-3">
                                        <img id="previewImagen"
                                            th:src="${plato.imagenUrl != null ? plato.imagenUrl : ''}"
                                            alt="Vista previa del plato" class="preview-image">
                                    </div>
                                    <h4 id="previewNombre"
                                        th:text="${plato.nombre != null ? plato.nombre : 'Nombre del Plato'}">
                                        Nombre del Plato
                                    </h4>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <p id="previewDescripcion" class="preview-descripcion"
                                        th:text="${plato.descripcion != null ? plato.descripcion : 'Descripción breve del plato...'}">
                                        Descripción breve del plato...
                                    </p>
                                    <span id="previewPrecio" class="preview-precio"
                                        th:text="${plato.precio != null ? 'S/ ' + plato.precio : 'S/ 0.00'}">
                                        S/ 0.00
                                    </span>
                                </div>
                                <span id="previewCategoria" class="badge categoria-badge"
                                    th:text="${plato.categoria != null ? plato.categoria : 'Categoría'}">
                                    Categoría
                                </span>
                                <span id="previewDisponibilidad" class="badge"
                                    th:classappend="${plato.disponible ? 'disponible-badge' : 'no-disponible-badge'}"
                                    th:text="${plato.disponible ? 'Disponible' : 'No Disponible'}">
                                    Disponible
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de platos recientes -->
                <div class="card mt-4 recent-items">
                    <div class="card-header">
                        <h5>Platos Recientes</h5>
                    </div>
                    <div class="card-body">
                        <div id="mensajeVacio" class="text-muted text-center" th:if="${#lists.isEmpty(platos)}">
                            No hay platos añadidos recientemente
                        </div>
                        <ul class="list-group" id="listaPlatos">
                            <li class="list-group-item d-flex justify-content-between align-items-center"
                                th:each="platoItem : ${platos}">
                                <div>
                                    <strong th:text="${platoItem.nombre}">Nombre del Plato</strong>
                                    <span class="badge categoria-badge ms-2"
                                        th:text="${platoItem.categoria}">Categoría</span>
                                </div>
                                <div>
                                    <a th:href="@{/platos/{id}(id=${platoItem.id})}"
                                        class="btn btn-sm btn-outline-primary me-1">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a th:href="@{/platos/eliminar/{id}(id=${platoItem.id})}"
                                        class="btn btn-sm btn-outline-danger"
                                        onclick="return confirm('¿Estás seguro de eliminar este plato?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script th:src="${/js/previewPlato.js}"></script>
</body>

</html>